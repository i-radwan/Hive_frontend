type: data

----------------
TO SERVER:
----------------

START: {
    mode: [SIMULATE|DEPLOY]
    state: state*
}

RESUME: {}

PAUSE: {}

STOP: {}

ORDER: {
    id:
    type: [REFILL|COLLECT]
    gate_id:
    rack_id:
    items: [
        {
            id:
            quantity:
        }
    ]
    start_timestep:                             # To support orders scheduling
}

ACK: {}

DEACTIVATE: {
    id:
}

ACTIVATE: {
    id:
}

BLOCKED: {
    id:
}

----------------
FROM SERVER:
----------------
ACK_START: {
    status: [OK|ERROR]
    msg: msg                                    # In the ERROR case
}

ACK_RESUME: {
    status: [OK|ERROR]
    msg: msg                                    # In the ERROR case
}

ACK_ORDER: {
    status: [OK|ERROR]
    msg: msg                                    # In the ERROR case
}

UPDATE: {
    timestep:
    actions: [
        {
            type: [MOVE|ROTATE_RIGHT|ROTATE_LEFT|RETREAT|LOAD|OFFLOAD|BIND|UNBIND],
            data: {...}
        }, {  # Default ROBOT direction = ROBOT_DIR.RIGHT
            type: MOVE,
            data: {
                id
                row:
                col:
            }
        }, {
            type: ROTATE_RIGHT,
            data: {
                id:
                row:
                col:
            }
        }, {
            type: ROTATE_LEFT,
            data: {
                id:
                row:
                col:
            }
        }, {
            type: RETREAT,
            data: {
                id:
                row:                            # The row that the robot was supposed to move to
                col:                            # The col that the robot was supposed to move to
            }
        }, {
            type: LOAD,
            data: {
                id:
                row:
                col:
            }
        },
            type: OFFLOAD,
            data: {
                id:
                row:
                col:
            }
        }, {
            type: BIND,
            data: {
                id:
                row:
                col:
            }
        }, {
            type: UNBIND,
            data: {
                id:
                row:
                col:
            }
        }
    ],
    logs: [
        {
            type: [TASK_ASSIGNED|ITEM_DELIVERED|ORDER_FULFILLED|RACK_ADJUSTED|...]
            data: {...}
        }, {
            type: TASK_ASSIGNED
            data: {
                robot_id:
                robot_row:
                robot_col:
                rack_id:
                rack_row:                       # Original rack row
                racK_col:                       # Original rack col
            }
        }, {
            type: ITEM_DELIVERED
            data: {
                order_id:
                item_id:
                item_quantity:                  # Total for this order_id
            }
        }, {
            type: ORDER_FULFILLED
            data: {
                id:
            }
        }, {
            type: ORDER_ISSUED                  # Move order from upcoming to ongoing
            data: {
                id:
            }
        }, {
            type: RACK_ADJUSTED
            data: {
                id:
                row:
                col:
                items: [
                    {
                        id:
                        quantity: [+ve|-ve]
                    }, {
                        id:
                        quantity: [+ve|-ve]
                    }
                ]
            }
        }, {
            type: BATTERY_UPDATED
            data: {
                id:
                row:                            # The row/col that the robot is supposed to be there
                col:                            # after finishing last action.
                battery:                        # Percentage
            }
         }
    ],
    statistics: [                               # All statistics at once
        {
            key:
            value:
        },
        {
            key:
            value:
        }
    ]
}

DEACTIVATE: { # The row/col that the robot is supposed to be there after finishing last action.
              # If this will affect other robots, you will receive a BLOCKED msg from them
    id:
    row:
    col:
}

ACTIVATE: { # The row/col that the robot is supposed to be there after finishing last action.
    id:
    row:
    col:
}

MSG: {
    status: [INFO|ERROR]
    msg: msg
}

----------------
TO GFX:
----------------
INIT: {
    width:
    height:
}

OBJECT_HOVER: {
    type: [MAP_CELL.GATE|MAP_CELL.ROBOT|...]
}

**
OBJECT_ADD: { # Default ROBOT direction = ROBOT_DIR.RIGHT
    id:
    type: [MAP_CELL.GATE|MAP_CELL.ROBOT|...]
    row:
    col:
}

**
OBJECT_DELETE: {
    id:
    type: [MAP_CELL.GATE|MAP_CELL.ROBOT|...]
    row:
    col:
}

**
OBJECT_DRAG: {
    id:
    type: [MAP_CELL.GATE|MAP_CELL.ROBOT|...]
    src_row:
    src_col:
    dst_row:
    dst_col:
}

**
OBJECT_MOVE: { # Move the specified robot and the bound rack (if any). Then send ACK when done
               # Move one step forward by the current direction
    id:        # not necessarily needed but to be more general
    row:
    col:
}

**
OBJECT_ROTATE_RIGHT: { # Move the specified robot and the bound rack (if any). Then send ACK when done
    id:        # not necessarily needed but to be more general
    row:
    col:
}

**
OBJECT_ROTATE_LEFT: { # Move the specified robot and the bound rack (if any). Then send ACK when done
    id:        # not necessarily needed but to be more general
    row:
    col:
}

**
OBJECT_RETREAT: { # Rotate the robot 180 degree, the move back to the previous position. Then send ACK when done
    id:        # not necessarily needed but to be more general
    row:
    col:
}

**
OBJECT_HIGHLIGHT: {
    id:
    type: [MAP_CELL.GATE|MAP_CELL.ROBOT|...]
    row:
    col:
}

**
OBJECT_COLORIZE: {
    id:
    type: [MAP_CELL.GATE|MAP_CELL.ROBOT|...]
    row:
    col:
    color:                                      # HTML
}

**
OBJECT_DECOLORIZE: {
    id:
    type: [MAP_CELL.GATE|MAP_CELL.ROBOT|...]
    row:
    col:
}

**
OBJECT_BIND: { # Flash the bound object, send ACK
    id:                                         # Robot ID
    type:                                       # not necessarily needed
    row:                                        # Robot row
    col:
    object_id:                                  # Bound object ID
    object_type: [MAP_CELL.GATE|MAP_CELL.STATION]
}

**
OBJECT_UNBIND: { # Send ACK
    id:                                         # Robot ID
    type:                                       # not necessarily needed
    row:                                        # Robot row
    col:
    object_id:                                  # Bound object ID
    object_type: [MAP_CELL.GATE|MAP_CELL.STATION]
}

**
OBJECT_LOAD: { # Draw rack on top of the robot, send ACK
    id:                                         # Robot ID
    type:                                       # not necessarily needed
    object_id:                                  # Rack ID
    object_type:                                # not necessarily needed
    row:                                        # Rack row
    col:
}

**
OBJECT_OFFLOAD: { # Send ACK
    id:                                         # Robot ID
    type:                                       # not necessarily needed
    object_id:                                  # Rack ID
    object_type:                                # not necessarily needed
    row:                                        # Rack row
    col:
}

**
OBJECT_FAILURE: { # Stop, Send ACK, Flash red
    id:
    type:                                       # not necessarily needed
    row:                                        # The old row/col (the one that this robot was
    col:                                        # supposed to be at before finishing the current move)
}

**
OBJECT_STOP: { # Force stop, don't send ACK of the previous move
    id:
    type:                                       # not necessarily needed
    row:                                        # The old row/col (the one that this robot was
    col:                                        # supposed to be at before finishing the current move)
}

**
OBJECT_FIXED: { # Resume last move, Send ACK after finishing the original move
    id:
    type:                                       # not necessarily needed
    row:                                        # The old row/col (the one that this robot was
    col:                                        # supposed to be at before finishing the current move)
}

**
OBJECT_UPDATE: { # New status for the object (e.g. robot), such as the battery level
    type: [MAP_CELL.GATE|MAP_CELL.ROBOT|...]
    id:
    row:                                        # The old row/col (the one that this robot was
    col:                                        # supposed to be at before finishing the current move)
    battery:                                    # Percentage
}

SIMULATION_START: {}

SIMULATION_PAUSE: {}

SIMULATION_RESUME: {}

SIMULATION_STOP: {}

SIMULATION_ESC: {}

----------------
FROM GFX:
----------------
**
CELL_CLICK: {
    row:
    col:
    id:
    type:
}

**
CELL_DRAG: {
    id:
    type:
    src_row:
    src_col:
    dst_row:
    dst_col:
}

**
CELL_DELETE: {
    id:
    type:
    row:
    col:
}

CELL_HOVER: {
    row:
    col:
}

ACK_ACTION: {
    type:                                       # Echo event type
    data:                                       # Echo event data
}

ESC: {
}

----------------
----------------
----------------

* state = {
              "map": {
                  "height":10,
                  "width":17,
                  "grid": [
                      [
                          {
                              "facility": {
                                  "id":1,
                                  "type":2,
                                  "capacity":250,
                                  "items": [
                                      {
                                          "id":1,
                                          "quantity":1
                                      }
                                  ]
                              }
                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          }
                      ],
                      [
                          {

                          },
                          {

                          },
                          {

                          },
                          {
                              "robot": {
                                  "id":3,
                                  "color":"#FF0000",
                                  "direction":0,
                                  "load_cap":100,
                                  "ip":"",
                                  "port":""
                              }
                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {
                              "facility": {
                                  "id":2,
                                  "type":0
                              }
                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {
                              "robot": {
                                  "id":4,
                                  "color":"#FF0000",
                                  "direction":0,
                                  "load_cap":100,
                                  "ip":"",
                                  "port":""
                              }
                          },
                          {
                              "facility": {
                                  "id":1,
                                  "type":0
                              }
                          },
                          {

                          },
                          {

                          }
                      ],
                      [
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          }
                      ],
                      [
                          {

                          },
                          {
                              "facility": {
                                  "id":4,
                                  "type":0
                              }
                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          }
                      ],
                      [
                          {

                          },
                          {

                          },
                          {
                              "facility": {
                                  "id":2,
                                  "type":2,
                                  "capacity":250,
                                  "items": [
                                      {
                                          "id":2,
                                          "quantity":1
                                      }
                                  ]
                              }
                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          }
                      ],
                      [
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {
                              "facility": {
                                  "id":3,
                                  "type":0
                              }
                          },
                          {

                          },
                          {

                          }
                      ],
                      [
                          {
                              "robot": {
                                  "id":1,
                                  "color":"#FF0000",
                                  "direction":0,
                                  "load_cap":100,
                                  "ip":"",
                                  "port":""
                              }
                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          }
                      ],
                      [
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {
                              "facility": {
                                  "id":3,
                                  "type":2,
                                  "capacity":250,
                                  "items": [
                                      {
                                          "id":3,
                                          "quantity":1
                                      },
                                      {
                                          "id":1,
                                          "quantity":10
                                      }
                                  ]
                              }
                          },
                          {

                          },
                          {

                          },
                          {
                              "robot": {
                                  "id":2,
                                  "color":"#FF0000",
                                  "direction":0,
                                  "load_cap":100,
                                  "ip":"",
                                  "port":""
                              }
                          },
                          {

                          }
                      ],
                      [
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          }
                      ],
                      [
                          {
                              "facility": {
                                  "id":4,
                                  "type":2,
                                  "capacity":250,
                                  "items": [
                                      {
                                          "id":4,
                                          "quantity":10
                                      }
                                  ]
                              }
                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          },
                          {

                          }
                      ]
                  ]
              },
              "items": [
                  {
                      "id":1,
                      "weight":2
                  },
                  {
                      "id":2,
                      "weight":150
                  },
                  {
                      "id":3,
                      "weight":200
                  },
                  {
                      "id":4,
                      "weight":1
                  }
              ],
              "stock": {

              },
              "nextIDs": {
                  "gate":5,
                  "robot":5,
                  "rack":5,
                  "station":1,
                  "obstacle":1,
                  "item":5
              }
          }


----------------
----------------
----------------
Note: all above constants have to match the front end constant.js file